<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cc.mrbird.febs.system.dao.TreatmentRecordMapper">

    <!-- 根据消息ID查询治疗记录 -->
    <select id="selectByMessageId" resultType="cc.mrbird.febs.system.domain.TreatmentRecord">
        SELECT * FROM treatment_record WHERE message_id = #{messageId}
    </select>
    
    <!-- 根据服务器记录ID查询治疗记录 -->
    <!-- 注意：由于表中没有server_record_id字段，使用message_id字段查询（serverRecordId被用作messageId） -->
    <select id="selectByServerRecordId" resultType="cc.mrbird.febs.system.domain.TreatmentRecord">
        SELECT * FROM treatment_record WHERE message_id = #{serverRecordId}
    </select>
    
    <!-- 根据患者唯一标识查询治疗记录列表 -->
    <select id="selectByPatientIdentifier" resultType="cc.mrbird.febs.system.domain.TreatmentRecord">
        SELECT * FROM treatment_record 
        WHERE patient_identifier = #{patientIdentifier}
        ORDER BY pres_date DESC, pres_time DESC
    </select>

    <!-- 分页查询治疗记录 -->
    <select id="selectTreatmentRecordPage" resultType="cc.mrbird.febs.system.domain.vo.TreatmentRecordVO">
        SELECT 
            tr.id,
            tr.message_id,
            tr.timestamp,
            tr.device_id,
            tr.device_no,
            tr.medical_record_id,
            tr.patient_id,
            tr.patient_identifier,
            tr.patient_name,
            tr.patient_sex,
            tr.patient_age_str,
            tr.patient_room,
            tr.patient_no,
            tr.patient_bed,
            tr.pres_date,
            tr.pres_time,
            tr.doctor_name,
            tr.mep_value,
            tr.medical_record_remark,
            tr.message_type,
            tr.create_time,
            tr.update_time
        FROM treatment_record tr
        ORDER BY tr.create_time DESC
    </select>

    <!-- 根据ID查询完整的治疗记录信息 -->
    <select id="selectTreatmentRecordById" resultType="cc.mrbird.febs.system.domain.vo.TreatmentRecordVO">
        SELECT 
            tr.id,
            tr.message_id,
            tr.timestamp,
            tr.device_id,
            tr.device_no,
            tr.medical_record_id,
            tr.patient_id,
            tr.patient_identifier,
            tr.patient_name,
            tr.patient_sex,
            tr.patient_age_str,
            tr.patient_room,
            tr.patient_no,
            tr.patient_bed,
            tr.pres_date,
            tr.pres_time,
            tr.doctor_name,
            tr.mep_value,
            tr.medical_record_remark,
            tr.message_type,
            tr.create_time,
            tr.update_time
        FROM treatment_record tr
        WHERE tr.id = #{id}
    </select>

    <!-- 查询治疗记录列表（不分页） -->
    <select id="selectTreatmentRecordList" resultType="cc.mrbird.febs.system.domain.vo.TreatmentRecordVO">
        SELECT 
            tr.id,
            tr.message_id,
            tr.timestamp,
            tr.device_id,
            tr.device_no,
            tr.medical_record_id,
            tr.patient_id,
            tr.patient_identifier,
            tr.patient_name,
            tr.patient_sex,
            tr.patient_age_str,
            tr.patient_room,
            tr.patient_no,
            tr.patient_bed,
            tr.pres_date,
            tr.pres_time,
            tr.doctor_name,
            tr.mep_value,
            tr.medical_record_remark,
            tr.message_type,
            tr.create_time,
            tr.update_time
        FROM treatment_record tr
        ORDER BY tr.create_time DESC
    </select>

</mapper>
